

<!DOCTYPE html>
<html lang="zh-CN" >



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="dingrui">
  <meta name="keywords" content="">
  
    <meta name="description" content="TCP\IP详解卷11 重传一个直接处理分组丢失和比特差错的方法是重发分组直到它被正确接收 那么就需要一种方法来判断  接收方是否已经收到分组 接收方接收到到的分组是否与之前发送方发送的是一样的 接收方给发送方发送信号以确定自己已经接收到了一个分组，这种方法被称为确认，即ACK 发送方发送一个分组，然后等待一个ACK 当接收方接收到这个分组时，它发送对应的ACK 当发送方接收到这个ACK，它再发送">
<meta property="og:type" content="article">
<meta property="og:title" content="读书-TCPIP详解">
<meta property="og:url" content="https://bannirui.github.io/2023/05/18/%E8%AF%BB%E4%B9%A6-TCPIP%E8%AF%A6%E8%A7%A3/index.html">
<meta property="og:site_name" content="hex Blog">
<meta property="og:description" content="TCP\IP详解卷11 重传一个直接处理分组丢失和比特差错的方法是重发分组直到它被正确接收 那么就需要一种方法来判断  接收方是否已经收到分组 接收方接收到到的分组是否与之前发送方发送的是一样的 接收方给发送方发送信号以确定自己已经接收到了一个分组，这种方法被称为确认，即ACK 发送方发送一个分组，然后等待一个ACK 当接收方接收到这个分组时，它发送对应的ACK 当发送方接收到这个ACK，它再发送">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://bannirui.github.io/2023/05/18/%E8%AF%BB%E4%B9%A6-TCPIP%E8%AF%A6%E8%A7%A3/image-20230529124002367.png">
<meta property="article:published_time" content="2023-05-18T07:55:07.000Z">
<meta property="article:modified_time" content="2025-01-24T15:52:43.666Z">
<meta property="article:author" content="dingrui">
<meta property="article:tag" content="网络">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://bannirui.github.io/2023/05/18/%E8%AF%BB%E4%B9%A6-TCPIP%E8%AF%A6%E8%A7%A3/image-20230529124002367.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>读书-TCPIP详解 - hex Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  



  
<link rel="stylesheet" href="/css/iconfont_gmail/iconfont.css">
<link rel="stylesheet" href="/css/iconfont_outlook/iconfont.css">
<link rel="stylesheet" href="/css/my-collapse.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"bannirui.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":2,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":"G-N6M7VZCQMD"},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=G-N6M7VZCQMD", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', 'G-N6M7VZCQMD');
        });
      }
    </script>
  

  

  

  



  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>hex Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archive</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>Category</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tag</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>About</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="读书-TCPIP详解"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-05-18 15:55" pubdate>
          2023年5月18日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          6.5k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          55 分钟
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> 次
        </span>
        

      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar category-bar" style="margin-right: -1rem">
    





<div class="category-list">
  
  
    
    
    
    <div class="category row nomargin-x">
      <a class="category-item 
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="读书笔记"
        id="heading-f44d4b523ff110f3126ff57530ea5253" role="tab" data-toggle="collapse" href="#collapse-f44d4b523ff110f3126ff57530ea5253"
        aria-expanded="true"
      >
        读书笔记
        <span class="list-group-count">(6)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse show" id="collapse-f44d4b523ff110f3126ff57530ea5253"
           role="tabpanel" aria-labelledby="heading-f44d4b523ff110f3126ff57530ea5253">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2023/02/28/x86%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80-%E4%BB%8E%E5%AE%9E%E6%A8%A1%E5%BC%8F%E5%88%B0%E4%BF%9D%E6%8A%A4%E6%A8%A1%E5%BC%8F/" title="x86汇编语言-从实模式到保护模式"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">x86汇编语言-从实模式到保护模式</span>
        </a>
      
    
      
      
        <a href="/2023/02/28/%E4%BB%8EPaxos%E5%88%B0Zookeeper-%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%80%E8%87%B4%E6%80%A7%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5/" title="从Paxos到Zookeeper-分布式一致性原理与实践"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">从Paxos到Zookeeper-分布式一致性原理与实践</span>
        </a>
      
    
      
      
        <a href="/2023/02/28/%E5%88%86%E5%B8%83%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F/" title="分布式数据库系统"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">分布式数据库系统</span>
        </a>
      
    
      
      
        <a href="/2023/02/28/%E5%A4%A7%E5%9E%8B%E5%88%86%E5%B8%83%E5%BC%8F%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84-%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/" title="大型分布式网站架构-设计与实现"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">大型分布式网站架构-设计与实现</span>
        </a>
      
    
      
      
        <a href="/2023/02/28/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84-%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/" title="大型网站技术架构-核心原理与案例分析"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">大型网站技术架构-核心原理与案例分析</span>
        </a>
      
    
      
      
        <a href="/2023/05/18/%E8%AF%BB%E4%B9%A6-TCPIP%E8%AF%A6%E8%A7%A3/" title="读书-TCPIP详解"
           class="list-group-item list-group-item-action
           active">
          <span class="category-post">读书-TCPIP详解</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
</div>


  </aside>


    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">读书-TCPIP详解</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="TCP-IP详解卷1"><a href="#TCP-IP详解卷1" class="headerlink" title="TCP\IP详解卷1"></a>TCP\IP详解卷1</h2><h3 id="1-重传"><a href="#1-重传" class="headerlink" title="1 重传"></a>1 重传</h3><p>一个直接处理分组丢失和比特差错的方法是重发分组直到它被正确接收</p>
<p>那么就需要一种方法来判断</p>
<ul>
<li>接收方是否已经收到分组</li>
<li>接收方接收到到的分组是否与之前发送方发送的是一样的<ul>
<li>接收方给发送方发送信号以确定自己已经接收到了一个分组，这种方法被称为确认，即ACK<ul>
<li>发送方发送一个分组，然后等待一个ACK</li>
<li>当接收方接收到这个分组时，它发送对应的ACK</li>
<li>当发送方接收到这个ACK，它再发送另一个分组</li>
</ul>
</li>
<li>这个衍生3个问题<ul>
<li>发送方对一个ACK应该等待多长时间</li>
<li>如果ACK丢失了怎么办</li>
<li>如果分组被接收到了，但是里面有错怎么办</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="1-1-发送方对ACK应该等待多长时间"><a href="#1-1-发送方对ACK应该等待多长时间" class="headerlink" title="1.1 发送方对ACK应该等待多长时间"></a>1.1 发送方对ACK应该等待多长时间</h4><p>发送方决定去等待多长时间与发送方期待为一个ACK等待多长时间有关</p>
<h4 id="1-2-如果ACK丢失了怎么办"><a href="#1-2-如果ACK丢失了怎么办" class="headerlink" title="1.2 如果ACK丢失了怎么办"></a>1.2 如果ACK丢失了怎么办</h4><p>如果一个ACK丢了，从接收方视角来看</p>
<ul>
<li>ACK丢了，接收方接收不到ACK信息</li>
<li>原分组丢了，接收方接收不到ACK信息</li>
</ul>
<p>即，发送方并不能轻易地把ACK丢了这种情况跟原分组丢失的情况区分开来，因此接收方一律简单处理-再次发送原分组</p>
<p>这样的话，从接收方视角来看，接收方可能会接收到两个或更多的拷贝，因此接收方必须想办法处理这种情况</p>
<h5 id="接收方怎么处理重复分组"><a href="#接收方怎么处理重复分组" class="headerlink" title="接收方怎么处理重复分组"></a>接收方怎么处理重复分组</h5><p>使用序列号处理，在被源端发送时，每个唯一的分组都有一个新的序列号，这个序列号由分组自身一直携带。接收方可以根据序列号判断自己是否已经见过这个分组，如果见过分组就直接丢弃它</p>
<h4 id="1-3分组被接收但是分组有错怎么办"><a href="#1-3分组被接收但是分组有错怎么办" class="headerlink" title="1.3分组被接收但是分组有错怎么办"></a>1.3分组被接收但是分组有错怎么办</h4><p>使用简单的编码进行差错检测，不需要进行纠正差错，当接收方接收到了一个含有差错的分组时，它就不发送ACK，触发发送发的超时重发，最后，发送方重发完整的无差错的分组</p>
<h3 id="2-分组窗口和滑动窗口"><a href="#2-分组窗口和滑动窗口" class="headerlink" title="2 分组窗口和滑动窗口"></a>2 分组窗口和滑动窗口</h3><p>为了提高吞吐，需要允许多个分组同时进入网络，需要考虑的场景有</p>
<ul>
<li>发送方<ul>
<li>不仅要决定什么时间注入一个分组到网络中，还要考虑注入多少个</li>
<li>在等待ACK时，怎么维护计时器</li>
<li>要保存每一个还没被确认的分组，防止需要重传</li>
</ul>
</li>
<li>接收方<ul>
<li>需要准备一套ACK机制，可以区分哪些分组已经收到，哪些分组还没收到</li>
<li>需要准备一套缓存机制，用来保存分组，因为分组的到来可能是乱序的</li>
</ul>
</li>
<li>如果接收方的接收速率&gt;发送方法发送速率，怎么办</li>
<li>如果发送方发送速率<ul>
<li>接收方可能会因为内存限制丢掉这些分组，怎么办</li>
<li>中间的路由器也可能由于处理或者内存限制，丢掉分组，怎么办</li>
</ul>
</li>
<li>网络基础设置处理不了发送方和接收方想要使用的数据发送率怎么办</li>
</ul>
<h4 id="2-1-分组窗口"><a href="#2-1-分组窗口" class="headerlink" title="2.1 分组窗口"></a>2.1 分组窗口</h4><p>定义一个分组窗口，这个窗口作为一个集合，存放什么内容呢</p>
<p>哪些已经被发送方注入网络，但是发送方还没收到ACK的分组</p>
<p>这个分组窗口中的分组数量就称为窗口大小</p>
<h4 id="2-2-滑动窗口"><a href="#2-2-滑动窗口" class="headerlink" title="2.2 滑动窗口"></a>2.2 滑动窗口</h4><p>滑动窗口结构在发送方和接收方都会定义一个</p>
<ul>
<li>发送方<ul>
<li>记录着哪些分组可以被释放</li>
<li>哪些分组正在等待ACK</li>
<li>哪些分组还不能被发送出去</li>
</ul>
</li>
<li>接收方<ul>
<li>记录着哪些分组已经被接收和确认</li>
<li>哪些分组是下一步期望的</li>
<li>哪些分组即使被接收也将会因为内存限制而被丢弃</li>
</ul>
</li>
</ul>
<h4 id="2-3-变量窗口"><a href="#2-3-变量窗口" class="headerlink" title="2.3 变量窗口"></a>2.3 变量窗口</h4><p>流量控制-为了处理接收方相对发送方太慢时产生的问题，在接收方跟不上时会强迫发送方慢下来</p>
<p>流量控制方式通常有两种</p>
<ul>
<li>基于速率-给发送方指定某个速率，同时确保数据永远不能超过这个速率发送</li>
<li>基于窗口-窗口大小是不固定的，而是允许随时间而变动的</li>
</ul>
<p>为了使用基于窗口流量控制，必须有一种方法让接收方可以通知发送方使用多大的窗口，这个动作称为窗口通告或者叫窗口更新</p>
<h3 id="3-重传超时"><a href="#3-重传超时" class="headerlink" title="3 重传超时"></a>3 重传超时</h3><p>如何设置发送方重传超时，也就是重传的超时时间设置多久合适</p>
<p>发送方在重发一个分组之前应该等待的时间量大概包括</p>
<ul>
<li>发送方发送分组所用的时间</li>
<li>接收方处理分组以及发送一个ACK所用的时间</li>
<li>ACK从接收方返回到发送方所用的时间</li>
<li>发送方处理ACK所用的时间</li>
</ul>
<p>不过可惜的是，以上时间没有一个确切知道的</p>
<p>甚至，以上几个或者全部都会随着来自客户端主机或路由器的额外负载的增加或减少而随时发生改变</p>
<p>也就是说，让用户主动告诉协议，在每种情况下应该将超时时间设置为多少，这是不可能的，也不合理</p>
<p>因此，更高的策略是让协议自己尝试去估计超时时间</p>
<p>RTT&#x3D;round-trip-time 往返时间</p>
<h4 id="3-1-RTT"><a href="#3-1-RTT" class="headerlink" title="3.1 RTT"></a>3.1 RTT</h4><p>传输协议选择一组RTT样本的均值作为真实的RTT，分组穿过网络的路径是可能会改变的，也就是说这个均值不是静态值，是一个跟随实际传输而改变的动态值</p>
<ul>
<li>但是，直接将RTT均值直接设置成超时是不合理的，毕竟均值只是一个既定事实的统计数据</li>
<li>如果将超时时间设置得刚好等于RTT均值，很有可能导致发生不必要的分组重传</li>
<li>因此超时时间应该设置得比RTT均值要大一些</li>
<li>但是如果超时时间设置得过大，显而易见的问题是可能导致网络比较空闲，系统的吞吐率会下降</li>
<li>因此超时时间具体设置得比RTT均值大多少是个学问</li>
</ul>
<h4 id="3-2-重传计时器"><a href="#3-2-重传计时器" class="headerlink" title="3.2 重传计时器"></a>3.2 重传计时器</h4><p>TCP发送一组报文段时，通常只设置一个重传计时器，等待接收方的ACK。</p>
<p>发送方不会为每个报文段都设置一个单独的重传计时器，而是发送一个窗口的数据，只设置一个重传计时器，一个窗口的分组共用一个重传计时器，每收到一个ACK就更新超时</p>
<p>但凡出现计时器到期，就将发送窗口内的分组都重发一遍</p>
<h3 id="4-ACK"><a href="#4-ACK" class="headerlink" title="4 ACK"></a>4 ACK</h3><p>TCP接收到连接另一端的数据时候，它就会发送一个ACK</p>
<p>这个ACK可能不是立即发送，可能会延迟一个时间</p>
<p>TCP使用的ACK时累积的，即一个N的ACK语义是，[…N)已经被接收</p>
<p>这样设计的好处是，如果一个ACK丢了，很有可能后续的ACK就足够确认前面的报文段了</p>
<h3 id="5-TCP"><a href="#5-TCP" class="headerlink" title="5 TCP"></a>5 TCP</h3><p>一个TCP连接由一个4元组构成，它们分别是两个IP地址和两个端口号</p>
<p>一个TCP连接是由一对端点或套接字构成，其中通信的每一端都有一对[IP，端口]所唯一标识</p>
<h4 id="5-1-3次握手"><a href="#5-1-3次握手" class="headerlink" title="5.1 3次握手"></a>5.1 3次握手</h4><ul>
<li>让通信双方了解一个连接正在建立</li>
<li>利用数据包的选项来承载特殊的信息，交换初始序列号</li>
</ul>
<h4 id="5-2-半关闭"><a href="#5-2-半关闭" class="headerlink" title="5.2 半关闭"></a>5.2 半关闭</h4><p>TCP的半关闭操作是指仅关闭数据流的一个传输方向，而两个半关闭操作合在一起就能够关闭整个连接</p>
<h4 id="5-3-TIME-WAIT"><a href="#5-3-TIME-WAIT" class="headerlink" title="5.3 TIME_WAIT"></a>5.3 TIME_WAIT</h4><p>TIME_WAIT状态也称为2MSL等待状态</p>
<p>在该状态中，TCP将会等待两倍于最大段生存期的时间，即2个MSL的时间，因此TIME_WAIT也被称为加倍等待</p>
<p>每个实现都必须为最大段生存期选择一个数值，它代表的是任何报文段在被丢弃前在网络中被允许存在的最长时间</p>
<p>MSL这个时间是有限制的，因为TCP报文段是以IP数据报的形式在传输的，IP数据报拥有TTL字段和跳数限制字段，这两个字段共同限制了IP数据报的有效生存时间</p>
<p>常见的实现中，最大段生存期的数值可以是30s\1分钟\2分钟，在绝大多数情况下，这一数值是可以修改的</p>
<p>当TCP执行一个主动关闭并发送最终的ACK时，连接必须处于TIME_WAIT状态并持续2倍于最大生存期的时间。这样就能够让TCP重新发送最终的ACK以避免出现丢失的情况。重新发送最终的ACK不是因为TCP主动要重传ACK，因为ACK本身并不消耗序列号，重传ACK是被动重传的，因为对端重传了它的FIN，FIN会消耗一个序号。因为对端主动重传了FIN，因此收到对端FIN之后又被动重传了这个FIN对应的ACK</p>
<h3 id="6-延时确认"><a href="#6-延时确认" class="headerlink" title="6 延时确认"></a>6 延时确认</h3><p>在许多情况下，TCP并不对每个到来的数据包都返回ACK，利用TCP的累积ACK确认字段就能实现该功能</p>
<p>累积确认可以允许TCP延迟一段时间发送ACK，以便将ACK和相同方向上需要传输的数据组合发送</p>
<p>采用延时ACK的方法可以减少ACK传输数目，可以一定程度地减轻网络负载</p>
<h3 id="7-Nagle算法"><a href="#7-Nagle算法" class="headerlink" title="7 Nagle算法"></a>7 Nagle算法</h3><p>当一个TCP连接中有在传数据，也就是有已经发送但是还没确认的数据，那些长度小于SMSS的报文段就被定义为小的报文段，他们是不能继续被发送的，直到所有的在传数据都收到ACK</p>
<p>在收到ACK后，TCP需要收集这些小的数据，将他们整合到一个报文段中去发送</p>
<p>也就是说用小数据包的时效换取整个发送的网络利用率和吞吐率</p>
<p>这种方法迫使TCP遵循停等规程-只有等接收到所有在传数据的ACK后才能继续发送</p>
<p>这个算法的精妙之处就在于，实现了自时钟控制</p>
<ul>
<li>ACK返回越快，数据传输也越快</li>
<li>在相当于高延迟的广域网中，更需要减少微型报的数目</li>
<li>该算法使得单位时间内发送的报文段数目更少</li>
<li>RTT控制着发包速率</li>
</ul>
<h3 id="8-TCP拥塞控制"><a href="#8-TCP拥塞控制" class="headerlink" title="8 TCP拥塞控制"></a>8 TCP拥塞控制</h3><p>拥塞控制是批量数据传输总最重要的</p>
<p>拥塞控制是TCP通信的每一方需要执行的一系列行为，这些行为由特定的算法规定，用于防止网络因为大规模的通信负载而瘫痪</p>
<p>有理由认为网络即将进入拥塞状态，或者已经由于拥塞而出现了路由器丢包情况，这个时候拥塞控制算法减缓TCP传输</p>
<p>需要克服3个难点</p>
<ul>
<li>TCP拥塞控制的难点在于怎么准确地判断何时需要减缓</li>
<li>怎么减缓TCP传输</li>
<li>何时恢复原有的传输速度</li>
</ul>
<h4 id="8-1-路由器排队理论"><a href="#8-1-路由器排队理论" class="headerlink" title="8.1 路由器排队理论"></a>8.1 路由器排队理论</h4><p>即使路由器能够存储一些数据，但是如果源源不断的数据的到达速率是高于发出速率的，任何中间的存储都会溢出</p>
<p>当某一个路由器在单位时间内接收到的数据量多于其可发送的数据量时，路由器就需要把多余的数据存储起来</p>
<p>如果这种情况持续，最终存储砌砖就会耗尽，路由器只能开始丢弃部分数据</p>
<h4 id="8-2-什么叫拥塞"><a href="#8-2-什么叫拥塞" class="headerlink" title="8.2 什么叫拥塞"></a>8.2 什么叫拥塞</h4><p>路由器因为无法处理高速率到达的流量而被迫丢弃数据信息的现象就叫拥塞</p>
<p>当路由器处于拥塞状态时，就说明出现了拥塞现象</p>
<p>即使仅仅只有一条通信连接，也可能造成一个甚至多个路由器拥塞，如果不采取措施，网络性能将会收到极大的影响甚至瘫痪</p>
<p>在最坏的情况下，形成拥塞崩溃</p>
<p>因此，为了避免或者缓解拥塞情况，TCP通信的每一方都实行了拥塞控制机制</p>
<h4 id="8-3-拥塞检测"><a href="#8-3-拥塞检测" class="headerlink" title="8.3 拥塞检测"></a>8.3 拥塞检测</h4><p>在互联网中很难做到让TCP知晓，也就是说没有一个精确的方法知晓路由器的状态，即没有一个明确的信号告知拥塞状况已经发生</p>
<ul>
<li>通常是看是否有丢包情况发生，在TCP中，丢包被用作判断拥塞发生与否的指标，用来衡量是否实施相应的响应措施</li>
<li>延时测量</li>
<li>显式拥塞通知</li>
</ul>
<p>对于TCP而言，如果发生了丢包情况，TCP的任务是重传这些数据包</p>
<p>那么TCP发现有丢包现象发生后，TCP还能做什么，如何识别这些丢包现象就是表明已经出现了拥塞，进而进行减速操作</p>
<h4 id="8-4-TCP减缓发送"><a href="#8-4-TCP减缓发送" class="headerlink" title="8.4 TCP减缓发送"></a>8.4 TCP减缓发送</h4><p>如何减缓TCP发送</p>
<p>根据接收方剩余缓存空间的大小，在TCP头部设置了通知窗口大小的字段，这个数值是TCP发送方调解发送速率的依据</p>
<p>当接收速率或者网络传输速率过慢时，就需要降低发送速率</p>
<p>引入一个窗口控制变量，这个变量却表发送窗口大小不超过接收端接收能力和网络传输能力，也就是TCP发送端的发送速率&#x3D;min(接收速率，传输速率)</p>
<p>拥塞窗口cwnd反映了网络传输能力</p>
<p>2个核心算法，慢启动和拥塞避免，这两个算法是基于包守恒和ACK时钟原理，这两个算法不是同时运行的，在任一时刻，TCP只运行其中一个算法，但是这两个算法可以相互切换</p>
<h5 id="8-4-1-慢启动"><a href="#8-4-1-慢启动" class="headerlink" title="8.4.1 慢启动"></a>8.4.1 慢启动</h5><p>慢启动的目的是什么</p>
<ul>
<li><p>使TCP在用拥塞避免探寻更多可用带宽之前得到cwnd值</p>
</li>
<li><p>帮助TCP建立ACK时钟</p>
</li>
</ul>
<p>什么时候会启用慢启动算法</p>
<ul>
<li>一个新的TCP连接建立的时候</li>
<li>检测到由重传超时导致丢包时</li>
<li>TCP发送端长时间处于空闲状态</li>
</ul>
<h5 id="8-4-2-拥塞避免"><a href="#8-4-2-拥塞避免" class="headerlink" title="8.4.2 拥塞避免"></a>8.4.2 拥塞避免</h5><p>为了得到更多的传输资源而不影响其他连接传输，TCP实现了拥塞避免算法</p>
<p>一旦确立慢启动阈值，TCP会进入拥塞避免阶段，cwnd每次的增长值近似于成功传输的数据段大小</p>
<p>这种随时间线性增长方式于慢启动的指数增长相比缓慢很多</p>
<h3 id="9-TCP保活机制"><a href="#9-TCP保活机制" class="headerlink" title="9 TCP保活机制"></a>9 TCP保活机制</h3><p>TCP保活机制为了解决什么问题</p>
<ul>
<li>一些情况下，客户端和服务端需要了解什么时候终止进程或者与对方断开连接</li>
<li>一些情况下，虽然应用进程之间没有任何数据交换，但仍然需要通过连接保持一个最小的数据流</li>
</ul>
<p>TCP保活机制在一种不影响数据流内容的情况下探测对方，通过一个保活计时器实现，当计时器被激发，连接一端将发送一个保活探测报文，另一端接收报文的同时会发送一个ACK作为响应</p>
<h4 id="9-1-保活探测报文"><a href="#9-1-保活探测报文" class="headerlink" title="9.1 保活探测报文"></a>9.1 保活探测报文</h4><p>保活探测报文是一个空报文段或者只包含1字节，它的序列号等于对方主机发送的ACK报文段的最大序列号减1，收到了对端ACK说明seq-1这个数据段已经被对端成功接收，所以不会对已经达到对端的报文段造成影响</p>
<p>探测报文段返回的响应可以确定连接是否仍在工作</p>
<p>探测及其响应报文段都不包含任何新的有效数据，可以看成好是垃圾数据，当他们丢失的时候也不会进行重传</p>
<h4 id="9-2-探测状态"><a href="#9-2-探测状态" class="headerlink" title="9.2 探测状态"></a>9.2 探测状态</h4><p>TCP保活功能需要主动开启，开启功能的一端会发现对端处于以下4个状态之一</p>
<ul>
<li>对端主机仍在工作，并且可以到达</li>
<li>对端主机已经崩溃，已经关闭或者正在重新启动</li>
<li>对端主机崩溃并且已经重启</li>
<li>对端主机仍在工作，但是由于某些原因不能到达请求端</li>
</ul>
<p>请求端不用担心对端主机正常关闭然后重启这种情况。当系统关机时，所有的应用进程会终止，他们的TCP会发送一个FIN。当请求端收到FIN后，会向请求端进程报告文件结束，并在检测到该状态后退出</p>
<h2 id="TCP-IP详解卷2"><a href="#TCP-IP详解卷2" class="headerlink" title="TCP\IP详解卷2"></a>TCP\IP详解卷2</h2><h3 id="1-系统调用"><a href="#1-系统调用" class="headerlink" title="1 系统调用"></a>1 系统调用</h3><p>什么叫系统调用</p>
<p>所有操作系统都提供服务访问点，程序可以通过它们请求内核中的服务。Unix提供了有限个内核入口点。这些入口点就是系统调用</p>
<h3 id="2-描述符"><a href="#2-描述符" class="headerlink" title="2 描述符"></a>2 描述符</h3><h4 id="2-1-描述符特性"><a href="#2-1-描述符特性" class="headerlink" title="2.1 描述符特性"></a>2.1 描述符特性</h4><ul>
<li>可以用描述符调用read和write</li>
<li>可以用dup复制它</li>
<li>在调用fork后，父进程和子进程可以共享它</li>
<li>可以调用fcntl来改变它的属性</li>
<li>可以调用close来关闭它</li>
</ul>
<h4 id="2-2-插口描述符"><a href="#2-2-插口描述符" class="headerlink" title="2.2 插口描述符"></a>2.2 插口描述符</h4><p>socket的返回值是一个描述符，它具有unix描述符的所有特性</p>
<h3 id="3-系统调用过程"><a href="#3-系统调用过程" class="headerlink" title="3 系统调用过程"></a>3 系统调用过程</h3><img src="/2023/05/18/%E8%AF%BB%E4%B9%A6-TCPIP%E8%AF%A6%E8%A7%A3/image-20230529124002367.png" srcset="/img/loading.gif" lazyload class="">

<ul>
<li><p>当进程执行一个系统调用，内核就会访问进程表结构</p>
</li>
<li><p>进程表的表项指向filedesc结构</p>
<ul>
<li>fd_ofileflags 字符数组指针 每个描述符有一个描述符标志</li>
<li>fd_ofiles 指向文件表结构的指针数组的指针</li>
</ul>
</li>
</ul>
<h4 id="3-1-file"><a href="#3-1-file" class="headerlink" title="3.1 file{}"></a>3.1 file{}</h4><p>fd_ofiles指向的数据结构用*file{}[]来表示</p>
<ul>
<li>它是指向file结构的指针数组</li>
<li>这个数组及描述符标志数组的下标就是描述符本身</li>
<li>结构file的成员f_type指示描述符的类型<ul>
<li>DTYPE_SOCKET</li>
<li>DTYPE_VNODE 是一个通用机制 允许内核支持不同类型的文件系统<ul>
<li>磁盘文件系统</li>
<li>网络文件系统</li>
<li>CD-ROM文件系统</li>
<li>基于存储器的文件系统</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="4-mbuf"><a href="#4-mbuf" class="headerlink" title="4 mbuf"></a>4 mbuf</h3><p>mbuf的主要用途是保存进程和网络接口间相互传递的用户数据，但mbuf也用于保存其他各种数据</p>
<ul>
<li>源与目标地址</li>
<li>插口选项</li>
</ul>
<p>常见4种类型的mbuf，它们依据在成员m_flags中填写不同的标志M_PKTHDR和M_EXT而不同</p>
<ul>
<li>如果m_flags等于0，mbuf只包含数据</li>
<li>m_flags的值是M_PKTHDR，它指示这是一个分组首部，描述一个分组数据的第一个mbuf</li>
<li>没有设置K_PKTHDR，不包含分组首部，但包含超过208字节的数据，这时用到一个叫做簇的外部缓存</li>
<li>mbuf包含一个分组首部，并包含超过208字节的数据，同时设置了标志M_PKTHDR和M_EXT</li>
</ul>
<h3 id="5-中断级别"><a href="#5-中断级别" class="headerlink" title="5 中断级别"></a>5 中断级别</h3><p>网络代码处理输入分组用的是异步和中断驱动的方式</p>
<p>一个设备中断引发接口层代码执行，然后它产生一个软中断引发协议层代码执行，当内核完成这些级别的中断后，执行插口代码</p>
<h3 id="6-主机和路由器"><a href="#6-主机和路由器" class="headerlink" title="6 主机和路由器"></a>6 主机和路由器</h3><p>在一个Internet上的系统通常能划分为两类</p>
<ul>
<li>主机 一个主机通常有一个网络接口，并且是一个IP分组的源或目标方</li>
<li>路由器 一个路由器有多个网络接口，当分组向它的目标方移动时将分组从一个网络转发到下一个网络</li>
</ul>
<h3 id="7-IP"><a href="#7-IP" class="headerlink" title="7 IP"></a>7 IP</h3><p>IP具有一种重要功能，就是当分组过大而不适合在所选硬件接口上发送时，能够对分组进行分片</p>
<p>过的分组被分成两个或多个大小适合在所选定网络上发送的IP分片</p>
<p>在去目的主机的路途中，分片还可能被中间的路由器继续分片</p>
<p>在目的主机上，一个IP数据报可能放在一个IP分组内，或者，如果在发送时被分片，就放在多个IP分组内。因为各个分片可能以不同的路径到达目的主机，所以只有目的主机才有机会看到所有分片</p>
<p>因此，也只有目的主机才能把所有分片重装成一个完整的数据报，提交给合适的运输层协议</p>
<h4 id="7-1-IP首部"><a href="#7-1-IP首部" class="headerlink" title="7.1 IP首部"></a>7.1 IP首部</h4><p>IP首部内有3个字段实现分片和重装</p>
<ul>
<li>ip_id 标识字段</li>
<li>if_off高3bit 标志字段<ul>
<li>比特0时保留位 必须为0</li>
<li>比特1是DF不分片标志</li>
<li>比特2是MF更多分片标志</li>
</ul>
</li>
<li>ip_off低13比特 偏移字段</li>
</ul>
<h3 id="8-socket结构"><a href="#8-socket结构" class="headerlink" title="8 socket结构"></a>8 socket结构</h3><p>插口代表一条通信链路的一端，存储或指向与链路有关的所有信息</p>
<ul>
<li>使用的协议</li>
<li>协议的状态信息(包括源和目的地址)</li>
<li>到达的连接队列</li>
<li>数据缓存</li>
<li>可选标志</li>
</ul>
<h3 id="9-socket系统调用"><a href="#9-socket系统调用" class="headerlink" title="9 socket系统调用"></a>9 socket系统调用</h3><p>socket系统调用产生一个新的插口，并将插口同进程在参数domain、type和protocol中制定的协议联系起来</p>
<p>该函数分配一个新的描述符，用来在后续的系统调用中标识插口，并将描述符返回给进程</p>
<h4 id="9-1-参数结构"><a href="#9-1-参数结构" class="headerlink" title="9.1 参数结构"></a>9.1 参数结构</h4><p>每一个系统调用的前面，都定义了一个描述进程传递给内核的参数的结构</p>
<p>参数是通过socket_args传入的</p>
<p>所有插口层系统调用都有3个参数</p>
<ul>
<li>p 指向调用进程的proc结构</li>
<li>uap 指向包含进程传送给系统调用的参数的结构</li>
<li>retval 用来接收系统调用的返回值</li>
</ul>
<h4 id="9-2-bind"><a href="#9-2-bind" class="headerlink" title="9.2 bind"></a>9.2 bind</h4><p>bind系统调用将一个本地的网络运输层地址和插口联系起来</p>
<p>作为客户的进程并不关心它的本地地址是什么，进程在通信之前并不需要调用bind，内核会自动为其选择一个本地地址</p>
<p>服务器进程则总是需要绑定到一个已知的地址上，进程在接收连接TCP或者接收数据报UDP之前必须调用bind，因为客户进程需要同已知的地址建立连接或者发送数据报到已知的地址</p>
<h4 id="9-3-listen"><a href="#9-3-listen" class="headerlink" title="9.3 listen"></a>9.3 listen</h4><p>listen系统调用的功能是通知协议进程准备接收插口上的连接请求</p>
<p>它同时也指定插口上可以排队等待的连接数的门限值</p>
<p>超过门限值时，插口层将拒绝进入的连接请求排队等待，在这种情况出现时，TCP将忽略进入的连接请求</p>
<h4 id="9-4-accept"><a href="#9-4-accept" class="headerlink" title="9.4 accept"></a>9.4 accept</h4><p>调用listen后，进程调用accept等待连接请求</p>
<p>accept返回一个新的描述符，指向一个连接到客户端的新的插口，原来的插口仍然是未连接的，并准备接收下一个连接</p>
<p>处理连接的细节由与插口相关联的协议来完成，对于TCP而言，当一条连接已经被建立，也就是完成了三次握手，就通知插口层</p>
<h2 id="TCP-IP详解卷3"><a href="#TCP-IP详解卷3" class="headerlink" title="TCP\IP详解卷3"></a>TCP\IP详解卷3</h2><h3 id="1-TAO"><a href="#1-TAO" class="headerlink" title="1 TAO"></a>1 TAO</h3><p>T&#x2F;TCP的核心是TAO，即TCP加速打开，这项技术使得T&#x2F;TCP服务器收到T&#x2F;TCP客户的SYN报文段后能够知道这个SYN是新的，从而可以跳过三次握手</p>
<p>确保服务器所收SYN是新SYN的技术就是TAO测试，这个技术是为主机已经建立的每个连接分配一个唯一的标识符，这个标识符是连接记数CC</p>
<p>每个T&#x2F;TCP主机都要把与每一个对等主机之间最新连接的CC值保留一段时间</p>
<p>如果所收SYN报文段的CC值大于从对等主机接收的最新CC值，那么TAO测试成功</p>
<h3 id="2-TIME-WAIT"><a href="#2-TIME-WAIT" class="headerlink" title="2 TIME_WAIT"></a>2 TIME_WAIT</h3><p>设置TIME_WAIT状态的原因有两个</p>
<ul>
<li>实现了全双工的连接关闭</li>
<li>使过时的重复报文作废</li>
</ul>
<h4 id="2-1-TCP全双工关闭"><a href="#2-1-TCP全双工关闭" class="headerlink" title="2.1 TCP全双工关闭"></a>2.1 TCP全双工关闭</h4><p>TIME_WAIT状态出现在执行主动关闭的一端，该端发出最后一个ACK报文段，如果这个ACK丢失或者对端最后一个FIN丢失，那么结果就是对端因为重传超时内没收到ACK，所以会重发一次FIN报文段。 因此，在主动关闭的一端保留连接的状态信息，这样它才能在需要的时候重传最后的确认报文段</p>
<p>否则，它收到最后的FIN报文段后就无法重传最后的一个ACK，而只能发出RST报文段，从而造成虚假的错误信息</p>
<h4 id="2-2-让过时的重复报文段时效"><a href="#2-2-让过时的重复报文段时效" class="headerlink" title="2.2 让过时的重复报文段时效"></a>2.2 让过时的重复报文段时效</h4><p>TCP协议的运行基于一个基本的假设：互联网上的每一个IP数据报都有一个有限的生命期限，这个期限值是由IP首部的TTL(生存时间)字段去决定的。每一台路由器在转发IP数据报时都要将其TTL值减1</p>
<p>但如果该IP数据报在路由器中等待的时间超过1s，那就要把TTL的值减去等待的时间</p>
<p>实际上，很少有IP数据报在路由器中等待的时间超过1s，因而每个路由器通常把TTL的值减1</p>
<p>由于TTL字段的长度是8bit，因此每个IP数据报所能经历的转发次数至多255</p>

<div id="gitalk-container"></div>
<script src="https://cdn.bootcss.com/blueimp-md5/2.12.0/js/md5.min.js"></script><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

		<script>
		var gitalkConfig = {"clientID":"7045d14418805a2028d8","clientSecret":"1631bb54c4a78f35ba07c1d35af98e8057babde9","repo":"Bannirui.github.io","owner":"Bannirui","admin":"Bannirui","distractionFreeMode":false};
	    gitalkConfig.id = md5(location.pathname);
		var gitalk = new Gitalk(gitalkConfig);
	    gitalk.render("gitalk-container");
	    </script>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" class="category-chain-item">读书笔记</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E7%BD%91%E7%BB%9C/" class="print-no-link">#网络</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>读书-TCPIP详解</div>
      <div>https://bannirui.github.io/2023/05/18/读书-TCPIP详解/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>dingrui</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年5月18日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/05/18/Netty-0x07-%E6%88%91%E7%9C%BC%E4%B8%AD%E7%9A%84%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" title="Netty-0x07-我眼中的网络编程">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Netty-0x07-我眼中的网络编程</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/05/16/Netty-0x06-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%BC%98%E5%8C%96/" title="Netty-0x06-数据结构优化">
                        <span class="hidden-mobile">Netty-0x06-数据结构优化</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="gitalk-container"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#gitalk-container', function() {
      Fluid.utils.createCssLink('/css/gitalk.css')
      Fluid.utils.createScript('https://lib.baomitu.com/gitalk/1.8.0/gitalk.min.js', function() {
        var options = Object.assign(
          {"clientID":"7045d14418805a2028d8","clientSecret":"1631bb54c4a78f35ba07c1d35af98e8057babde9","repo":"Bannirui.github.io","owner":"Bannirui","admin":["Bannirui"],"language":"zh-CN","labels":["Gitalk"],"perPage":10,"pagerDirection":"last","distractionFreeMode":false,"createIssueManually":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token"},
          {
            id: '72be4a1d6b1959465a81a629b845cd14'
          }
        )
        var gitalk = new Gitalk(options);
        gitalk.render('gitalk-container');
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <div> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration.js"></script> </div> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    

  

</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
